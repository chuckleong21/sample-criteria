<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>sample-criteria • sample.criteria</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sample-criteria">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sample.criteria</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9500</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/sample-criteria.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>sample-criteria</h1>
            
      

      <div class="d-none name"><code>sample-criteria.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chuckleong21.github.io/sample-criteria/">sample.criteria</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>pmsampsize</code> package provides tools for determining
the minimum sample size required when developing a prediction model. In
this vignette, we’ll explore how to use the <code>pmsampsize</code>
function.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>You can install the <code>sample.criteria</code> package from Github
using the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("your.name/your.repository")</span></span></code></pre></div>
<p>Usage This package has two main functions:
<strong>pmsamplesize()</strong> and <strong>approximate_R2()</strong>.
pmsamplesize calculates the sample criteria defined by Riley (2018) for
binary outcome logistic regression models, and extended by Pate (2023)
for multinomial outcome logistic regression model. Here three kinds of
usage will be illustrated:</p>
<ol style="list-style-type: decimal">
<li>You have a binary outcome model but only C statistics and outcome
proportion are reported;</li>
<li>You have a binary outcome model but no
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{CS}</annotation></semantics></math>
is reported;</li>
<li>You have a multinomial outcome model but for distinct cohort models
no
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi><mi>_</mi><mi>a</mi><mi>d</mi><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>r</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{CS\_adj,k,r}</annotation></semantics></math>
are reported.</li>
</ol>
</div>
<div class="section level3">
<h3 id="case-1-only-c-statistics-is-reported">Case 1: Only C statistics is reported<a class="anchor" aria-label="anchor" href="#case-1-only-c-statistics-is-reported"></a>
</h3>
<p>In clinical studies, Cox-Snell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
often has the following issues: - The Cox-Snell R-squared is often
criticized for its lack of interpretability and its sensitivity to
censoring (when some event times are unknown due to follow-up
truncation). - It does not consider the actual distribution of survival
times or the shape of the hazard function. - Additionally, it assumes
that the proportional hazards assumption holds, which may not always be
the case.</p>
<p>We can then appropriate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{CS}</annotation></semantics></math>
using the C statistics and event prevalence (outcome proportion). The
steps are detailed in <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1002/sim.8806" class="external-link">here</a>
by Riley. We can execute the simulation with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chuckleong21.github.io/sample-criteria/">sample.criteria</a></span><span class="op">)</span></span>
<span><span class="co"># Noted here that k = 2 for binary outcomes</span></span>
<span><span class="fu"><a href="../reference/approximate_R2.html">approximate_R2</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, auc <span class="op">=</span> <span class="fl">0.81</span>, prev <span class="op">=</span> <span class="fl">0.77</span><span class="op">)</span></span>
<span><span class="co">#&gt; $R2.nagelkerke</span></span>
<span><span class="co">#&gt; [1] 0.3231788</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $R2.coxsnell</span></span>
<span><span class="co">#&gt; [1] 0.2132698</span></span></code></pre></div>
<p>Here, the can be directly used for calculating sample criteria since
it is gotten from another dataset. Assuming the new model aimed to
consider up to 30 predictor parameters, applying the sample size
criteria of Riley et al. Using pmsamplesize() then we should have a
minimum sample size of 1129:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">scriteria</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pmsamplesize.html">pmsamplesize</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="fl">30</span>, k <span class="op">=</span> <span class="fl">2</span>, auc <span class="op">=</span> <span class="fl">0.81</span>, prev <span class="op">=</span> <span class="fl">0.77</span>, sigma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">scriteria</span> </span>
<span><span class="co">#&gt; NB: Assuming 0.1 acceptable difference in apparent &amp; adjusted R-squared</span></span>
<span><span class="co">#&gt; NB: Assuming 0.05 margin of error in estimation of intercept</span></span>
<span><span class="co">#&gt; NB: Events per Predictor Parameter assumes prevalance 0.77</span></span>
<span><span class="co">#&gt;            sample_size shrinkage parameter    CS_Rsq   Max_Rsq   Nag_Rsq</span></span>
<span><span class="co">#&gt; Criteria 1        1129 0.9000000        30 0.2100957 0.3183689 0.3183689</span></span>
<span><span class="co">#&gt; Criteria 2        1674 0.8684059        30 0.2100957 0.3183689 0.3183689</span></span>
<span><span class="co">#&gt; Criteria 3         273 0.8684059        30 0.2100957 0.3183689 0.3183689</span></span>
<span><span class="co">#&gt; Final             1674 0.8684059        30 0.2100957 0.3183689 0.3183689</span></span>
<span><span class="co">#&gt;                 EPP</span></span>
<span><span class="co">#&gt; Criteria 1 28.97767</span></span>
<span><span class="co">#&gt; Criteria 2 42.96600</span></span>
<span><span class="co">#&gt; Criteria 3  7.00700</span></span>
<span><span class="co">#&gt; Final      42.96600</span></span>
<span><span class="co">#&gt; Minimum sample size required for new model development based on user inputs = 1674,</span></span>
<span><span class="co">#&gt;  with 1289 events (assuming an outcome prevalence = 0.77) and an EPP = 43</span></span></code></pre></div>
<p>Three criteria are reported in this example. The criterion targeting
the difference between the apprarent and optimism adjusted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>N</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>l</mi><mi>k</mi><mi>e</mi><mi>r</mi><mi>k</mi><mi>e</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{Nagelkerke}</annotation></semantics></math>
to be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mrow></mrow><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\delta{}=0.05</annotation></semantics></math>
has a larger example for modeling in the future.</p>
</div>
<div class="section level3">
<h3 id="case-2-when-no-cox-snell-r2-is-reported">Case 2: When No Cox-Snell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
is reported<a class="anchor" aria-label="anchor" href="#case-2-when-no-cox-snell-r2-is-reported"></a>
</h3>
<p>Event prevalences are observed more than often. We could use this
information to calculate the apparent Cox-Snell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
using a log-likelihood of a null model:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>n</mi><mi>L</mi><msub><mi>R</mi><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></msub><mo>=</mo><mi>E</mi><mi>l</mi><mi>n</mi><mfrac><mi>E</mi><mi>n</mi></mfrac><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>−</mo><mi>E</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>l</mi><mi>n</mi><mrow><mn>1</mn><mo>−</mo><mfrac><mi>E</mi><mi>n</mi></mfrac></mrow></mrow><annotation encoding="application/x-tex">lnLR_{null}=Eln{\frac{E}{n}}+(n-E)ln{1-\frac{E}{n}}</annotation></semantics></math>
where E is the number of outcome. Using the following command, the
sample criteria could calculate as usual:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pmsamplesize.html">pmsamplesize</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="fl">24</span>, k <span class="op">=</span> <span class="fl">2</span>, p <span class="op">=</span> <span class="fu">sample.criteria</span><span class="fu">:::</span><span class="fu"><a href="../reference/props_by_events.html">props_by_events</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">138</span> <span class="op">-</span> <span class="fl">24</span>, <span class="fl">24</span><span class="op">)</span><span class="op">)</span>, r2_nagelkerke <span class="op">=</span> <span class="fl">0.48</span><span class="op">)</span></span>
<span><span class="co">#&gt; NB: Assuming 0.05 acceptable difference in apparent &amp; adjusted R-squared</span></span>
<span><span class="co">#&gt; NB: Assuming 0.05 margin of error in estimation of intercept</span></span>
<span><span class="co">#&gt; NB: Events per Predictor Parameter assumes prevalance 0.174</span></span>
<span><span class="co">#&gt;            sample_size shrinkage parameter CS_Rsq Max_Rsq Nag_Rsq      EPP</span></span>
<span><span class="co">#&gt; Criteria 1         623 0.9000000        24  0.288     0.6    0.48 4.514493</span></span>
<span><span class="co">#&gt; Criteria 2         668 0.9056604        24  0.288     0.6    0.48 4.840580</span></span>
<span><span class="co">#&gt; Criteria 3         221 0.9056604        24  0.288     0.6    0.48 1.601449</span></span>
<span><span class="co">#&gt; Final              668 0.9056604        24  0.288     0.6    0.48 4.840580</span></span>
<span><span class="co">#&gt; Minimum sample size required for new model development based on user inputs = 668,</span></span>
<span><span class="co">#&gt;  with 116 events (assuming an outcome prevalence = 0.174) and an EPP = 4.84</span></span></code></pre></div>
<p>Here, the <em>p</em> argument must be outcome proportions, denoted as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>k</mi></msub><annotation encoding="application/x-tex">p_{k}</annotation></semantics></math>.
By defailt, the first element in the vector is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y=0</annotation></semantics></math>
group (benign) group. We could use the helper function to the return
outcome proportions by taking the number of events in different groups.
Here, the result reported the minimum sample size should be 668 under
criterion 2.</p>
</div>
<div class="section level3">
<h3 id="case-3-cohort-cox-snell-r2_cs_adjkr-approximation-with-c-statistics">Case 3: Cohort Cox-Snell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi><mi>_</mi><mi>a</mi><mi>d</mi><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>r</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{CS\_adj,k,r}</annotation></semantics></math>
approximation with C statistics<a class="anchor" aria-label="anchor" href="#case-3-cohort-cox-snell-r2_cs_adjkr-approximation-with-c-statistics"></a>
</h3>
<p>To calculate the criterion 1 minimum sample size, we need the cohort
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>C</mi><mi>S</mi><mi>_</mi><mi>a</mi><mi>d</mi><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>r</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{CS\_adj,k,r}</annotation></semantics></math>
information, which sometimes are not reported in studies. We can the
approximate them using the simulation approach put forward by Riley et
al. Estimates of the pairwise outcome proportions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mrow><mi>k</mi><mo>,</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">\phi_{k,r}</annotation></semantics></math>
of category k relative to the reference category r are also required to
implement the simulation approach. One can supply the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mrow><mi>k</mi><mo>,</mo><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">\phi_{k,r}</annotation></semantics></math>
value to argument , but it could also be left blank and the calculation
will be done internally with a helper function . The Pate’s example in
his work could be executed with the following demand:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note the prev argument is not default to NULL</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2557</span>, <span class="fl">186</span>, <span class="fl">176</span>, <span class="fl">467</span>, <span class="fl">120</span><span class="op">)</span></span>
<span><span class="va">c_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.92</span>, <span class="fl">0.99</span>, <span class="fl">0.95</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.87</span>, <span class="fl">0.87</span>, <span class="fl">0.71</span>, <span class="fl">0.82</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pmsamplesize.html">pmsamplesize</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="fl">17</span>, k <span class="op">=</span> <span class="fl">5</span>, p <span class="op">=</span> <span class="fu">sample.criteria</span><span class="fu">:::</span><span class="fu"><a href="../reference/props_by_events.html">props_by_events</a></span><span class="op">(</span><span class="va">events</span><span class="op">)</span>, auc <span class="op">=</span> <span class="va">c_stats</span>, prev <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; NB: Assuming 0.05 acceptable difference in apparent &amp; adjusted R-squared</span></span>
<span><span class="co">#&gt; NB: Assuming 0.05 margin of error in estimation of intercept</span></span>
<span><span class="co">#&gt;            sample_size shrinkage parameter    CS_Rsq   Max_Rsq Nag_Rsq</span></span>
<span><span class="co">#&gt; Criteria 1       13063      0.90        17 0.1261869 0.8412462    0.15</span></span>
<span><span class="co">#&gt; Criteria 2        1477      0.75        17 0.1261869 0.8412462    0.15</span></span>
<span><span class="co">#&gt; Criteria 3         524      0.75        17 0.1261869 0.8412462    0.15</span></span>
<span><span class="co">#&gt; Final            13063      0.90        17 0.1261869 0.8412462    0.15</span></span></code></pre></div>
<p>Conclusion Through the illustrations above, package can easily
calculate pre-defined sample criteria for future modelling given what
kind of information is reported in various studies.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
