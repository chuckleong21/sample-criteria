<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>sample-criteria</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">sample-criteria</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sample.criteria)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>pmsampsize</code> package provides tools for determining
the minimum sample size required when developing a prediction model. In
this vignette, we’ll explore how to use the <code>pmsampsize</code>
function.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the <code>sample.criteria</code> package from Github
using the following command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;your.name/your.repository&quot;)</span></span></code></pre></div>
<p>Usage This package has two main functions:
<strong>pmsamplesize()</strong> and <strong>approximate_R2()</strong>.
pmsamplesize calculates the sample criteria defined by Riley (2018) for
binary outcome logistic regression models, and extended by Pate (2023)
for multinomial outcome logistic regression model. Here three kinds of
usage will be illustrated:</p>
<ol style="list-style-type: decimal">
<li>You have a binary outcome model but only C statistics and outcome
proportion are reported;</li>
<li>You have a binary outcome model but no <span class="math inline">\(R^2_{CS}\)</span> is reported;</li>
<li>You have a multinomial outcome model but for distinct cohort models
no <span class="math inline">\(R^2_{CS\_adj,k,r}\)</span> are
reported.</li>
</ol>
</div>
<div id="case-1-only-c-statistics-is-reported" class="section level2">
<h2>Case 1: Only C statistics is reported</h2>
<p>In clinical studies, Cox-Snell <span class="math inline">\(R^2\)</span> often has the following issues: - The
Cox-Snell R-squared is often criticized for its lack of interpretability
and its sensitivity to censoring (when some event times are unknown due
to follow-up truncation). - It does not consider the actual distribution
of survival times or the shape of the hazard function. - Additionally,
it assumes that the proportional hazards assumption holds, which may not
always be the case.</p>
<p>We can then appropriate <span class="math inline">\(R^2_{CS}\)</span>
using the C statistics and event prevalence (outcome proportion). The
steps are detailed in <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1002/sim.8806">here</a>
by Riley. We can execute the simulation with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(sample.criteria)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># Noted here that k = 2 for binary outcomes</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">approximate_R2</span>(<span class="at">k =</span> <span class="dv">2</span>, <span class="at">auc =</span> <span class="fl">0.81</span>, <span class="at">prev =</span> <span class="fl">0.77</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; $R2.nagelkerke</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; [1] 0.3225301</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; $R2.coxsnell</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; [1] 0.2128417</span></span></code></pre></div>
<p>Here, the can be directly used for calculating sample criteria since
it is gotten from another dataset. Assuming the new model aimed to
consider up to 30 predictor parameters, applying the sample size
criteria of Riley et al. Using pmsamplesize() then we should have a
minimum sample size of 1129:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>scriteria <span class="ot">&lt;-</span> <span class="fu">pmsamplesize</span>(<span class="at">Q =</span> <span class="dv">30</span>, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">auc =</span> <span class="fl">0.81</span>, <span class="at">prev =</span> <span class="fl">0.77</span>, <span class="at">r2_nagelkerke =</span> <span class="fl">0.15</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Warning in pmsamplesize(Q = 30, k = 2, auc = 0.81, prev = 0.77, r2_nagelkerke =</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; 0.15): Inadequate information to calculate sample size for criterion 2</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>scriteria </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; NB: Assuming 0.05 acceptable difference in apparent &amp; adjusted R-squared</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; NB: Assuming 0.05 margin of error in estimation of intercept</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; NB: Events per Predictor Parameter assumes prevalance 0.77</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;            sample_size shrinkage parameter CS_Rsq Max_Rsq Nag_Rsq   EPP</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; Criteria 1        1130       0.9        30   0.21      NA    0.15 29.00</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; Criteria 3         273       0.9        30   0.21      NA    0.15  7.01</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; Final             1130       0.9        30   0.21      NA    0.15 29.00</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; Minimum sample size required for new model development based on user inputs = 1130,</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;  with 870 events (assuming an outcome prevalence = 0.77) and an EPP = 29</span></span></code></pre></div>
<p>Three criteria are reported in this example. The criterion targeting
the difference between the apprarent and optimism adjusted <span class="math inline">\(R^2_{Nagelkerke}\)</span> to be <span class="math inline">\(\delta{}=0.05\)</span> has a larger example for
modeling in the future.</p>
</div>
<div id="case-2-when-no-cox-snell-r2-is-reported" class="section level2">
<h2>Case 2: When No Cox-Snell <span class="math inline">\(R^2\)</span>
is reported</h2>
<p>Event prevalences are observed more than often. We could use this
information to calculate the apparent Cox-Snell <span class="math inline">\(R^2\)</span> using a log-likelihood of a null
model: <span class="math display">\[lnLR_{null}=Eln{\frac{E}{n}}+(n-E)ln{1-\frac{E}{n}}\]</span>
where E is the number of outcome. Using the following command, the
sample criteria could calculate as usual:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">pmsamplesize</span>(<span class="at">Q =</span> <span class="dv">24</span>, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">138</span> <span class="sc">-</span> <span class="dv">24</span>, <span class="dv">24</span>), <span class="at">r2_nagelkerke =</span> <span class="fl">0.48</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; NB: Assuming 0.05 acceptable difference in apparent &amp; adjusted R-squared</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; NB: Assuming 0.05 margin of error in estimation of intercept</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; NB: Events per Predictor Parameter assumes prevalance 0.174</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;            sample_size shrinkage parameter CS_Rsq Max_Rsq Nag_Rsq  EPP</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; Criteria 1         623     0.900        24  0.288     0.6    0.48 4.51</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; Criteria 2         668     0.906        24  0.288     0.6    0.48 4.84</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; Criteria 3         221     0.900        24  0.288     0.6    0.48 1.60</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; Final              668     0.906        24  0.288     0.6    0.48 4.84</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; Minimum sample size required for new model development based on user inputs = 668,</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;  with 116 events (assuming an outcome prevalence = 0.174) and an EPP = 4.84</span></span></code></pre></div>
<p>Here, the <em>p</em> argument must be outcome proportions, denoted as
<span class="math inline">\(p_{k}\)</span>. By defailt, the first
element in the vector is the <span class="math inline">\(Y=0\)</span>
group (benign) group. We could use the helper function to the return
outcome proportions by taking the number of events in different groups.
Here, the result reported the minimum sample size should be 668 under
criterion 2.</p>
</div>
<div id="case-3-cohort-cox-snell-r2_cs_adjkr-approximation-with-c-statistics" class="section level2">
<h2>Case 3: Cohort Cox-Snell <span class="math inline">\(R^2_{CS\_adj,k,r}\)</span> approximation with C
statistics</h2>
<p>To calculate the criterion 1 minimum sample size, we need the cohort
<span class="math inline">\(R^2_{CS\_adj,k,r}\)</span> information,
which sometimes are not reported in studies. We can the approximate them
using the simulation approach put forward by Riley et al. Estimates of
the pairwise outcome proportions <span class="math inline">\(\phi_{k,r}\)</span> of category k relative to the
reference category r are also required to implement the simulation
approach. One can supply the <span class="math inline">\(\phi_{k,r}\)</span> value to argument , but it
could also be left blank and the calculation will be done internally
with a helper function . The Pate’s example in his work could be
executed with the following demand:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Note the prev argument is not default to NULL</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">pmsamplesize</span>(<span class="at">Q =</span> <span class="dv">17</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>             <span class="at">k =</span> <span class="dv">5</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>             <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.729</span>, <span class="fl">0.053</span>, <span class="fl">0.05</span>, <span class="fl">0.133</span>, <span class="fl">0.034</span>),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>             <span class="at">r2_nagelkerke =</span> <span class="fl">0.15</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>             <span class="at">shrinkage =</span> <span class="fl">0.9</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>             <span class="at">auc =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.92</span>, <span class="fl">0.99</span>, <span class="fl">0.95</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.87</span>, <span class="fl">0.87</span>, <span class="fl">0.71</span>, <span class="fl">0.82</span>))</span></code></pre></div>
<p>Conclusion Through the illustrations above, package can easily
calculate pre-defined sample criteria for future modelling given what
kind of information is reported in various studies.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
